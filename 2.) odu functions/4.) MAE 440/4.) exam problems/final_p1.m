K = [2 -1  0  0  0; ...
    -1  4 -1  0  0; ...
     0 -1  4  0 -1; ...
     0  0  0  4 -1; ...
     0  0 -1 -1  2];
F = [3; 1; 2; 0; 2];

a4 = 1;
B1 = 2;
B3 = 1;
B = 0.5;
C = max(diag(K))*1e4;

Kp = K;
Kp(4,4) = Kp(4,4)+C;
Kp(1,1) = Kp(1,1)+C*B1^2;
Kp(1,3) = Kp(1,3)+C*B1*B3;
Kp(3,1) = Kp(3,1)+C*B3*B1;
Kp(3,3) = Kp(3,3)+C*B3^2;

Fp = F;
Fp(4) = Fp(4)+C*a4;
Fp(1) = Fp(1)+C*B1*B;
Fp(3) = Fp(3)+C*B3*B;

u = Kp^-1*Fp;
R = K*u-F;