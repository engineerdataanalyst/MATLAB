%% given
E = 200e3; %N/mm^2
I = [1.25e5; 1.25e5; 4e4]; %mm^4
L = [150; 75; 125];
P2 = -3000; %N

%% stiffness matricies
% ------------------
Ke = cell(3,1);
EIL = E.*I./L.^3;
% ------------------
Ke{1} = EIL(1)*[12     6*L(1)   -12     6*L(1)   0 0 0 0; ...
                6*L(1) 4*L(1)^2 -6*L(1) 2*L(1)^2 0 0 0 0; ...
               -12    -6*L(1)    12    -6*L(1)   0 0 0 0; ...
                6*L(1) 2*L(1)^2 -6*L(1) 4*L(1)^2 0 0 0 0; ...
                0      0         0      0        0 0 0 0; ...
                0      0         0      0        0 0 0 0; ...
                0      0         0      0        0 0 0 0; ...
                0      0         0      0        0 0 0 0];
% ------------------
Ke{2} = EIL(2)*[0 0  0      0         0      0        0 0;
                0 0  0      0         0      0        0 0;
                0 0  12     6*L(2)   -12     6*L(2)   0 0; ...
                0 0  6*L(2) 4*L(2)^2 -6*L(2) 2*L(2)^2 0 0; ...
                0 0 -12    -6*L(2)    12    -6*L(2)   0 0; ...
                0 0  6*L(2) 2*L(2)^2 -6*L(2) 4*L(2)^2 0 0; ...
                0 0  0      0         0      0        0 0; ...
                0 0  0      0         0      0        0 0];
% ------------------
Ke{3} = EIL(3)*[0 0  0 0  0      0         0      0;
                0 0  0 0  0      0         0      0;
                0 0  0 0  0      0         0      0;
                0 0  0 0  0      0         0      0;
                0 0  0 0  12     6*L(3)   -12     6*L(3); ...
                0 0  0 0  6*L(3) 4*L(3)^2 -6*L(3) 2*L(3)^2; ...
                0 0  0 0 -12    -6*L(3)    12    -6*L(3); ...
                0 0  0 0  6*L(3) 2*L(3)^2 -6*L(3) 4*L(3)^2];
% ------------------
K = Ke{1}+Ke{2}+Ke{3};

%% load vector
F = [0; 0; P2; 0; 0; 0; 0; 0];

%% solution
b = [1 7];
i = [2:6 8];
Kr = K(i,i);
Fr = F(i);

Qi = Kr^-1*Fr;
Q = [0; Qi(1:end-1); 0; Qi(end)];

Rb = K(b,:)*Q-F(b);
R = [Rb(1); 0; 0; 0; 0; 0; Rb(2); 0];